<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Songless Quiz ‚Ä¢ n0chh</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg: #0a0a12;
      --card-bg: rgba(18, 18, 32, 0.65);
      --text: #f0f0ff;
      --text-secondary: #a0a0c0;
      --accent: #8a6dff;
      --success: #4ade80;
      --error: #f87171;
      --border: rgba(255, 255, 255, 0.08);
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      --live-red: #ff4d4d;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Inter', sans-serif;
      line-height: 1.6;
      padding: 0;
      min-height: 100vh;
    }

    .stream-banner {
      background: linear-gradient(90deg, #1e1b4b, #312e81);
      padding: 20px;
      display: flex;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid white;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .stream-info {
      flex: 1;
      min-width: 250px;
    }

    .stream-title {
      font-size: 1.6rem;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .stream-meta {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      margin-top: 6px;
    }

    .meta-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.95rem;
      color: var(--text-secondary);
    }

    .live-indicator {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(255, 77, 77, 0.2);
      color: var(--live-red);
      padding: 4px 10px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.9rem;
    }

    .live-dot {
      width: 8px;
      height: 8px;
      background: var(--live-red);
      border-radius: 50%;
      box-shadow: 0 0 6px var(--live-red);
    }

    .container {
      max-width: 1000px;
      margin: 24px auto;
      padding: 0 20px;
    }

    .card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 28px;
      backdrop-filter: blur(12px);
      box-shadow: var(--shadow);
    }

    h2 {
      font-size: 1.4rem;
      font-weight: 600;
      margin-bottom: 18px;
      color: var(--accent);
    }

    /* Video */
    .video-wrapper {
      position: relative;
      border-radius: 12px;
      overflow: hidden;
      margin: 16px 0;
      box-shadow: var(--shadow);
    }

    .video-wrapper.blurred iframe {
      filter: blur(12px);
      transition: filter 0.4s ease;
    }

    .video-wrapper.unlocked iframe {
      filter: none;
    }

    /* Controls */
    .quiz-controls {
      display: flex;
      gap: 12px;
      margin: 16px 0;
      flex-wrap: wrap;
    }

    .timer-box {
      background: rgba(0,0,0,0.3);
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 1.1rem;
      color: var(--accent);
    }

    button {
      padding: 10px 18px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.2s;
    }

    button:hover { opacity: 0.9; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }

    .input-group {
      display: flex;
      gap: 12px;
      margin-top: 12px;
      flex-wrap: wrap;
    }

    #guess-input {
      flex: 1;
      min-width: 200px;
      padding: 12px 16px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: rgba(0, 0, 0, 0.2);
      color: var(--text);
      font-size: 1rem;
      outline: none;
    }

    #feedback {
      margin-top: 12px;
      min-height: 24px;
      font-weight: 500;
      text-align: center;
    }

    .success { color: var(--success); }
    .error { color: var(--error); }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
    }

    th, td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }

    th {
      color: var(--text-secondary);
      font-weight: 600;
    }

    tr:nth-child(even) {
      background: rgba(0, 0, 0, 0.1);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 16px;
      margin-top: 12px;
    }

    .stat-box {
      background: rgba(0, 0, 0, 0.2);
      padding: 14px;
      border-radius: 12px;
      text-align: center;
    }

    .stat-value {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--accent);
    }

    .stat-label {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    ul#top-usernames {
      list-style: none;
      padding: 0;
      margin-top: 12px;
    }

    ul#top-usernames li {
      padding: 8px 0;
      border-bottom: 1px solid var(--border);
    }

    @media (max-width: 768px) {
      .stream-banner { flex-direction: column; text-align: center; }
      .stream-info { display: flex; flex-direction: column; align-items: center; }
      .stream-meta { justify-content: center; }
      .input-group, .quiz-controls { flex-direction: column; }
      #guess-input, button { width: 100%; }
      .video-wrapper iframe { height: 200px; }
    }
  </style>
</head>
<body>
  <div class="stream-banner">
    <img id="streamer-avatar" class="avatar" src="https://via.placeholder.com/80/312e81/ffffff?text=n0chh" alt="Streamer avatar" />
    <div class="stream-info">
      <h1 id="stream-title">Loading stream...</h1>
      <div class="stream-meta">
        <div class="meta-item">üëÅÔ∏è <span id="banner-viewers">0</span> viewers</div>
        <div class="meta-item">üïí <span id="banner-uptime">00:00:00</span></div>
        <div class="live-indicator">
          <span class="live-dot"></span> LIVE
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <header style="text-align: center; margin-bottom: 24px;">
      <h2>üéµ Songless Quiz</h2>
      <p style="color: var(--text-secondary); font-size: 0.95rem;">Guess the song ‚Ä¢ Earn points ‚Ä¢ Chat with the community</p>
    </header>

    <section class="card">
      <h2>üéß Current Song</h2>
      <div class="video-wrapper blurred">
        <iframe
          id="youtube-player"
          width="100%"
          height="300"
          src=""
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
        ></iframe>
      </div>

      <div class="quiz-controls">
        <div class="timer-box">Time: <span id="countdown">15</span>s</div>
        <button id="skip-btn" onclick="skipSong()">Skip</button>
        <button id="reveal-btn" onclick="revealAnswer()" disabled>Reveal</button>
      </div>

      <div class="input-group">
        <input type="text" id="guess-input" placeholder="Type your guess (e.g., Blinding Lights - The Weeknd)" autocomplete="off" />
        <button onclick="submitGuess()">Submit</button>
      </div>
      <p id="feedback"></p>

      <h2>üèÜ Leaderboard</h2>
      <table id="scoreboard">
        <thead><tr><th>User</th><th>Points</th></tr></thead>
        <tbody id="scoreboard-body"></tbody>
      </table>
    </section>

    <section class="card">
      <h2>üìä Live Chat & Viewer Stats</h2>
      <div class="stats-grid">
        <div class="stat-box">
          <div class="stat-label">Session Time</div>
          <div id="session-duration" class="stat-value">00:00:00</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">Messages</div>
          <div id="message-count" class="stat-value">0</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">Unique Chatters</div>
          <div id="unique-usernames" class="stat-value">0</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">Peak Viewers</div>
          <div id="viewer-peak" class="stat-value">0</div>
        </div>
      </div>

      <h3 style="margin-top: 20px;">Top Chatters</h3>
      <ul id="top-usernames"></ul>
    </section>
  </div>

  <script>
    // ===== QUIZ LOGIC =====
    let currentSong = null;
    let countdown = 15;
    let countdownInterval = null;
    const scoreboard = new Map();
    const SONG_IDS = ['song1', 'song2', 'song3']; // ‚Üê Update with your JSON filenames

    function resetTimer() {
      clearInterval(countdownInterval);
      countdown = 15;
      document.getElementById('countdown').textContent = countdown;
    }

    function startTimer() {
      resetTimer();
      countdownInterval = setInterval(() => {
        countdown--;
        document.getElementById('countdown').textContent = countdown;
        if (countdown <= 0) {
          clearInterval(countdownInterval);
          revealAnswer();
        }
      }, 1000);
    }

    async function loadRandomSong() {
      if (SONG_IDS.length === 0) return;
      const id = SONG_IDS[Math.floor(Math.random() * SONG_IDS.length)];
      try {
        const res = await fetch(`songs/${id}.json`);
        if (!res.ok) throw new Error('Song file not found');
        const meta = await res.json();
        currentSong = { ...meta, id };

        const url = new URL(meta.youtube);
        const v = url.searchParams.get('v');
        if (!v) throw new Error('Invalid YouTube URL');

        // 10-second preview
        const preview = `https://www.youtube.com/embed/${v}?start=0&end=10&autoplay=1&mute=0`;
        document.getElementById('youtube-player').src = preview;
        document.querySelector('.video-wrapper').className = 'video-wrapper blurred';
        document.getElementById('feedback').textContent = '';
        document.getElementById('reveal-btn').disabled = false;

        startTimer();
      } catch (e) {
        console.error(e);
        document.getElementById('feedback').textContent = '‚ö†Ô∏è Failed to load song.';
      }
    }

    function submitGuess() {
      const input = document.getElementById('guess-input');
      const guess = input.value.trim();
      const feedback = document.getElementById('feedback');

      if (!guess || !currentSong) {
        feedback.className = 'error';
        feedback.textContent = 'Enter a guess!';
        return;
      }

      const correct = `${currentSong.title} - ${currentSong.artist}`.toLowerCase();
      if (guess.toLowerCase() === correct) {
        // Get username from Kick chat input (simulate via prompt for now)
        const user = prompt('‚úÖ Correct! Enter your username:')?.trim() || 'Anonymous';
        scoreboard.set(user, (scoreboard.get(user) || 0) + 10);
        updateScoreboard();

        feedback.className = 'success';
        feedback.textContent = `üéâ Correct, ${user}! +10 points!`;

        // Unlock full video
        const v = new URL(currentSong.youtube).searchParams.get('v');
        document.getElementById('youtube-player').src = `https://www.youtube.com/embed/${v}?autoplay=1`;
        document.querySelector('.video-wrapper').className = 'video-wrapper unlocked';

        clearInterval(countdownInterval);
        setTimeout(loadRandomSong, 4000);
      } else {
        feedback.className = 'error';
        feedback.textContent = '‚ùå Incorrect. Try again!';
      }
    }

    function skipSong() {
      clearInterval(countdownInterval);
      revealAnswer();
      setTimeout(loadRandomSong, 2000);
    }

    function revealAnswer() {
      if (!currentSong) return;
      clearInterval(countdownInterval);
      document.getElementById('feedback').className = 'error';
      document.getElementById('feedback').textContent = `‚è∞ Time‚Äôs up! Answer: ${currentSong.title} - ${currentSong.artist}`;
      document.getElementById('reveal-btn').disabled = true;

      // Unlock video on reveal too
      const v = new URL(currentSong.youtube).searchParams.get('v');
      document.getElementById('youtube-player').src = `https://www.youtube.com/embed/${v}?autoplay=1`;
      document.querySelector('.video-wrapper').className = 'video-wrapper unlocked';
    }

    function updateScoreboard() {
      const body = document.getElementById('scoreboard-body');
      body.innerHTML = '';
      [...scoreboard.entries()]
        .sort((a, b) => b[1] - a[1])
        .forEach(([user, pts]) => {
          const row = body.insertRow();
          row.insertCell(0).textContent = user;
          row.insertCell(1).textContent = pts;
        });
    }

    // Start first song
    loadRandomSong();

    // ===== SESSION TIMER (simple) =====
    const sessionStart = Date.now();
    setInterval(() => {
      const elapsed = Date.now() - sessionStart;
      const h = Math.floor(elapsed / 3600000).toString().padStart(2, '0');
      const m = Math.floor((elapsed % 3600000) / 60000).toString().padStart(2, '0');
      const s = Math.floor((elapsed % 60000) / 1000).toString().padStart(2, '0');
      document.getElementById('session-duration').textContent = `${h}:${m}:${s}`;
    }, 1000);
  </script>

  <!-- Kick Stats (kept minimal) -->
  <script>
    // You can keep your Kick stats logic here if needed.
    // But note: Kick's public API may not work reliably.
    // For now, we'll just set default values.
    document.getElementById('stream-title').textContent = 'n0chh ‚Ä¢ Songless Quiz';
    document.getElementById('banner-viewers').textContent = '‚Äî';
    document.getElementById('banner-uptime').textContent = '00:00:00';
  </script>
</body>
</html>
